# Домашнее задание к занятию "4.1. Командная оболочка Bash: Практические навыки"

## Задание 1

Есть скрипт:
```bash
a=1
b=2
c=a+b
d=$a+$b
e=$(($a+$b))
```
Какие значения переменным c,d,e будут присвоены? Почему?

| Переменная  | Значение | Обоснование |
| ------------- |----------| ------------- |
| `c`  | a+b      | Переменной с присвоина строка «а+b» |
| `d`  | 1+2      | d= строка значение перем-й а (1) + знач. перем-й b (2) |
| `e`  | 3        | e= число (( числовое знач. перем-й a + числовое знач. перем-й b)) |

----

## Задание 2

На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет
его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным 
(после чего скрипт должен завершиться). В скрипте допущена ошибка, из-за которой выполнение
не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо
сделать, чтобы его исправить:
```bash
while ((1==1)
do
	curl https://localhost:4757
	if (($? != 0))
	then
		date >> curl.log
	fi
done
```

### Ваш скрипт:
```bash
#Универсальный способ бесконечного цикла while (true)
while (true)
do
        curl http://localhost:4757
        # условия в ветвлении if ставиться в квадратных скобках []. Само условие меняем 
        # на проверку запуска сервиса и если он запущен тогда нужно завершить цикл
        if [ $? = 0 ]
        then
                break
        fi
        # если из цикла не вышли тогда регистрируем дату и время отсутствия соединения с 
        # сервисом. 
        date >> curl.log
        # так как мы просто регистрируем дату и время отсутствия соединения с сервисом, 
        # не стоит систему загружать постоянными опросами. Поэтому желательно установить 
        # задержку между запросами. Желательно задержку поставить больше. Выше задержка 
        # между запросами, значит меньше нагрузка на систему и сетевой интерфейс, а также 
        # и меньше расходуется место на диске. 
        sleep 2
done
```

---

## Задание 3

Необходимо написать скрипт, который проверяет доступность трёх IP: `192.168.0.1`, 
`173.194.222.113`, `87.250.250.242` по `80` порту и записывает результат в файл `log`. 
Проверять доступность необходимо пять раз для каждого узла.

### Ваш скрипт:
```bash
test(){
        for i in 1 2 3 4 5
        do
                nc -vz $1 80 2>>out.log
        done
}

val_ip1=192.168.0.1
val_ip2=173.194.222.113
val_ip3=87.250.250.242
test $val_ip1
test $val_ip2
test $val_ip3
```

---
## Задание 4

Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, 
пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла
пишется в файл error, скрипт прерывается.

### Ваш скрипт:
```bash
#!/bin/bash

test_port(){
output_err=$(nc -vz $1 80 2>&1 1>/dev/null)
out_var=$?
if [ $out_var = 1 ]
then
	echo "$(date) ${output_err}">>out_err.log
fi
return $out_var;
}

while (true)
do
	val_ip1=192.168.0.1
	test_port $val_ip1
	if [ $? = 1 ]; then break; fi

	val_ip2=173.194.222.113
	test_port $val_ip2
	if [ $? = 1 ]; then break; fi

	val_ip3=87.250.250.242
	test_port $val_ip3
	if [ $? = 1 ]; then break; fi

	sleep 3
done
```